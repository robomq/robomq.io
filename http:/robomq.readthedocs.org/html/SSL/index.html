<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="http://robomq.readthedocs.org/SSL/" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>SSL - robomq.io</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "SSL";
        var mkdocs_page_input_path = "SSL.md";
        var mkdocs_page_url = "/SSL/";
      </script>
    
    <script src="../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> robomq.io
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">What is RoboMQ.io</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../gettingStarted/">Getting started</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../creatingNewApplication/">Creating a new application</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../deviceIntegration/">IoT and M2M integration</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../applicationIntegration/">Application integration</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../SDK/">SDK & example codes</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">User Guide</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../AMQP/">AMQP Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../one-one/">One to one (direct) messaging</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../broadcast/">Broadcast (publish/subscribe)</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../routing-key/">Key based message routing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../topic/">Filter based routing (topic)</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../request-reply/">Request and reply</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../MQTT/">MQTT</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../STOMP/">STOMP</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../WebSTOMP/">WebSTOMP</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="./">SSL</a>
    <ul class="current">
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../REST/">REST</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../managed_file_transfer/">Managed File Transfer</a>
                  </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../IotAnalytics-walkthrough/">IoT Analytics</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Connectors</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../connectors/">Connectors</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../MS-Active%20Directory/">MS Active Directory</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ADP-to-AD_Connector/">ADP to AD</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../Workday_Connector/">Workday<sup>&reg;</sup> to AD</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../Atlassian%20JIRA%20-%20Connector/">Atlassian JIRA</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../Salesforce_Connector/">Salesforce</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../Database_Connector/">Database</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../Oracle-Database_Connector/">Oracle Database</a>
                  </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../about/">About</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">robomq.io</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a> &raquo;</li>
          <li>User Guide &raquo;</li>
      <li>SSL</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/robomq/robomq.io/edit/master/docs/SSL.md" class="icon icon-github"> Edit on GitHub</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="introduction">Introduction</h1>
<blockquote>
<p>Before reading this chapter, we assume that you already know AMQP protocol. Knowing MQTT and STOMP would be great too. If not, please go through at least the <em>Key based message routing</em> section in User Guide.</p>
</blockquote>
<p><a href="https://www.robomq.io" target="_blank">RoboMQ</a> has obtained certificate from a certificate authority (CA) and supports SSL (secure socket layer) connection for all available protocols, including AMQP, MQTT, STOMP and WebSTOMP. The SSL ports of those four protocols are respectively AMQP: 5671, MQTT: 8883, STOMP: 61614, WebSTOMP: 15673.  </p>
<p>This chapter intends to introduce you the method to establish SSL connection between <a href="https://www.robomq.io" target="_blank">RoboMQ</a> broker and your client program, except for WebSTOMP.  </p>
<p>The certificate of our root CA can be downloaded at <a href="http://www.tbs-x509.com/AddTrustExternalCARoot.crt" target="_blank">http://www.tbs-x509.com/AddTrustExternalCARoot.crt</a>. It is needed to verify the leaf certificate of <a href="https://www.robomq.io" target="_blank">RoboMQ</a> because the latter one was granted by the root CA through a chain of trust.  </p>
<p>In most cases, your device or application trying to connect to <a href="https://www.robomq.io" target="_blank">RoboMQ</a> broker are not like Web browsers. Browsers come with all CAs' certificates so  they're inherently able to verify the <a href="https://www.robomq.io" target="_blank">RoboMQ</a> certificate. That is why WebSTOMP client running inside a browser doesn't need any extra work to connect over SSL. In contrast, your device or application typically don't have the CA certificate to verify <a href="https://www.robomq.io" target="_blank">RoboMQ</a> certificate.  </p>
<p>Therefore, if you choose to or have to verify the leaf certificate of <a href="https://www.robomq.io" target="_blank">RoboMQ</a> in your client program, you will be required to download the root CA certificate at <a href="https://www.tbs-x509.com/AddTrustExternalCARoot.crt" target="_blank">https://www.tbs-x509.com/AddTrustExternalCARoot.crt</a> and import it in your program to achieve the verification. Otherwise, if you optionally ignore the certificate verification, it's not a necessity.  </p>
<p>An unfortunate fact is that not all message queue client libraries support SSL connection. Actually, only a small portion of them do. Hence, pick a capable library before you develop your SSL clients.  </p>
<h1 id="ssl-use-cases">SSL use cases</h1>
<p>We will provide examples of AMQP SSL clients of key based message routing scenario in Python. They are variants of the Python example in <em>Key based message routing</em> section. The only difference is that they connect over SSL, so we're going to focus on the connecting part of the code.  </p>
<p>The first example verifies <a href="https://www.robomq.io" target="_blank">RoboMQ</a> certificate, while the second one doesn't. You may choose to follow any of them according to your specific demands.  </p>
<p>Please refer to the <em>Key based message routing</em> section in User Guide for library dependency, program logic, code comments and everything irrelevant with connecting itself.  </p>
<p>The example code provided bellow could be the short version, it might have omitted some advanced details. For full version code, please go to our SDK <a href="https://github.com/robomq/robomq.io/tree/master/sdk/SSL" target="_blank">repository</a> on GitHub. </p>
<blockquote>
<p>Before testing the example code, replace hostname, yourvhost, username and password with the real variables in your network environment.<br />
Always run consumer first to create the exchange and queue for producer to send messages to.   </p>
</blockquote>
<h2 id="certificate-verified">Certificate verified</h2>
<h3 id="connect">Connect</h3>
<p>Compared to non-SSL connect method recapped bellow,  </p>
<pre><code class="language-python">credentials = pika.PlainCredentials(username, password)
connection = pika.BlockingConnection(pika.ConnectionParameters(host = server, port = port, virtual_host = vhost, credentials = credentials, heartbeat_interval = 60))
</code></pre>
<p>SSL connect method adds two parameters. It sets <code>ssl = True</code> and passes SSL options. The <code>"cert_reqs": ssl.CERT_REQUIRED</code> in SSL options implies the client requires to verify server's certificate.  </p>
<pre><code class="language-python">credentials = pika.PlainCredentials(username, password)
sslOptions = {&quot;cert_reqs&quot;: ssl.CERT_REQUIRED, &quot;ca_certs&quot;: caCert}
parameters = pika.ConnectionParameters(host = server, port = port, virtual_host = vhost, credentials = credentials, heartbeat_interval = 60, ssl = True, ssl_options = sslOptions)
connection = pika.BlockingConnection(parameters)
</code></pre>
<p>If the root CA certificate file isn't provided or isn't the one downloaded at <a href="http://www.tbs-x509.com/AddTrustExternalCARoot.crt">http://www.tbs-x509.com/AddTrustExternalCARoot.crt</a>, client will fail to verify <a href="https://www.robomq.io" target="_blank">RoboMQ</a> certificate thus fail to connect.  </p>
<h3 id="putting-it-together">Putting it together</h3>
<p><strong>producer.py</strong></p>
<pre><code class="language-python">import pika
import ssl

server = &quot;hostname&quot;
port = 5671
vhost = &quot;yourvhost&quot; 
username = &quot;username&quot;
password = &quot;password&quot;
caCert = &quot;./AddTrustExternalCARoot.crt&quot; #change it to the actual path to CA certificate
exchangeName = &quot;testEx&quot;
routingKey = &quot;test&quot;

try:
    #connect
    credentials = pika.PlainCredentials(username, password)
    sslOptions = {&quot;cert_reqs&quot;: ssl.CERT_REQUIRED, &quot;ca_certs&quot;: caCert}
    parameters = pika.ConnectionParameters(host = server, port = port, virtual_host = vhost, credentials = credentials, heartbeat_interval = 60, ssl = True, ssl_options = sslOptions)
    connection = pika.BlockingConnection(parameters)
    channel = connection.channel()

    #send message
    properties = pika.spec.BasicProperties(content_type = &quot;text/plain&quot;, delivery_mode = 1)
    channel.basic_publish(exchange = exchangeName, routing_key = routingKey, body = &quot;Hello World!&quot;, properties = properties)

    #disconnect
    connection.close()
except Exception, e:
    print e
</code></pre>
<p><strong>consumer.py</strong></p>
<pre><code class="language-python">import pika
import ssl
import time

server = &quot;hostname&quot;
port = 5671
vhost = &quot;yourvhost&quot; 
username = &quot;username&quot;
password = &quot;password&quot;
caCert = &quot;./AddTrustExternalCARoot.crt&quot; #change it to the actual path to CA certificate
exchangeName = &quot;testEx&quot;
queueName = &quot;testQ1&quot;
routingKey = &quot;test&quot;

#callback funtion on receiving messages
def onMessage(channel, method, properties, body):
    print body

while True:
    try:
        #connect
        credentials = pika.PlainCredentials(username, password)
        sslOptions = {&quot;cert_reqs&quot;: ssl.CERT_REQUIRED, &quot;ca_certs&quot;: caCert}
        parameters = pika.ConnectionParameters(host = server, port = port, virtual_host = vhost, credentials = credentials, heartbeat_interval = 60, ssl = True, ssl_options = sslOptions)
        connection = pika.BlockingConnection(parameters)
        channel = connection.channel()

        #declare exchange and queue, bind them and consume messages
        channel.exchange_declare(exchange = exchangeName, exchange_type = &quot;direct&quot;, auto_delete = True)
        channel.queue_declare(queue = queueName, exclusive = True, auto_delete = True)
        channel.queue_bind(exchange = exchangeName, queue = queueName, routing_key = routingKey)
        channel.basic_consume(consumer_callback = onMessage, queue = queueName, no_ack = True)
        channel.start_consuming()
    except Exception, e:
        #reconnect on exception
        print &quot;Exception handled, reconnecting...\nDetail:\n%s&quot; % e
        try:
            connection.close()
        except:
            pass
        time.sleep(5)
</code></pre>
<h2 id="certificate-not-verified">Certificate not verified</h2>
<h3 id="connect_1">Connect</h3>
<p>Compared to certificate-verified connect method above, certificate-not-verified connect method changes <code>"cert_reqs": ssl.CERT_REQUIRED</code> to <code>"cert_reqs": ssl.CERT_NONE</code> in SSL options. That implies the client doesn't require to verify server's certificate.  </p>
<pre><code class="language-python">credentials = pika.PlainCredentials(username, password)
sslOptions = {&quot;cert_reqs&quot;: ssl.CERT_NONE}
parameters = pika.ConnectionParameters(host = server, port = port, virtual_host = vhost, credentials = credentials, heartbeat_interval = 60, ssl = True, ssl_options = sslOptions)
connection = pika.BlockingConnection(parameters)
</code></pre>
<p>Even if the root CA certificate is provided, it will be ignored.  </p>
<p>You can safely use this method to connect to <a href="https://www.robomq.io" target="_blank">RoboMQ</a> broker over SSL without verification because <a href="https://www.robomq.io" target="_blank">RoboMQ</a> is a trustworthy service provider. However, this way is generally not recommended for unknown services.  </p>
<h3 id="putting-it-together_1">Putting it together</h3>
<p><strong>producer.py</strong></p>
<pre><code class="language-python">import pika
import ssl

server = &quot;hostname&quot;
port = 5671
vhost = &quot;yourvhost&quot; 
username = &quot;username&quot;
password = &quot;password&quot;
exchangeName = &quot;testEx&quot;
routingKey = &quot;test&quot;

try:
    #connect
    credentials = pika.PlainCredentials(username, password)
    sslOptions = {&quot;cert_reqs&quot;: ssl.CERT_NONE}
    parameters = pika.ConnectionParameters(host = server, port = port, virtual_host = vhost, credentials = credentials, heartbeat_interval = 60, ssl = True, ssl_options = sslOptions)
    connection = pika.BlockingConnection(parameters)
    channel = connection.channel()

    #send message
    properties = pika.spec.BasicProperties(content_type = &quot;text/plain&quot;, delivery_mode = 1)
    channel.basic_publish(exchange = exchangeName, routing_key = routingKey, body = &quot;Hello World!&quot;, properties = properties)

    #disconnect
    connection.close()
except Exception, e:
    print e
</code></pre>
<p><strong>consumer.py</strong></p>
<pre><code class="language-python">import pika
import ssl
import time

server = &quot;hostname&quot;
port = 5671
vhost = &quot;yourvhost&quot; 
username = &quot;username&quot;
password = &quot;password&quot;
exchangeName = &quot;testEx&quot;
queueName = &quot;testQ1&quot;
routingKey = &quot;test&quot;

#callback funtion on receiving messages
def onMessage(channel, method, properties, body):
    print body

while True:
    try:
        #connect
        credentials = pika.PlainCredentials(username, password)
        sslOptions = {&quot;cert_reqs&quot;: ssl.CERT_NONE}
        parameters = pika.ConnectionParameters(host = server, port = port, virtual_host = vhost, credentials = credentials, heartbeat_interval = 60, ssl = True, ssl_options = sslOptions)
        connection = pika.BlockingConnection(parameters)
        channel = connection.channel()

        #declare exchange and queue, bind them and consume messages
        channel.exchange_declare(exchange = exchangeName, exchange_type = &quot;direct&quot;, auto_delete = True)
        channel.queue_declare(queue = queueName, exclusive = True, auto_delete = True)
        channel.queue_bind(exchange = exchangeName, queue = queueName, routing_key = routingKey)
        channel.basic_consume(consumer_callback = onMessage, queue = queueName, no_ack = True)
        channel.start_consuming()
    except Exception, e:
        #reconnect on exception
        print &quot;Exception handled, reconnecting...\nDetail:\n%s&quot; % e
        try:
            connection.close()
        except:
            pass
        time.sleep(5)
</code></pre>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../WebSTOMP/" class="btn btn-neutral float-left" title="WebSTOMP"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../REST/" class="btn btn-neutral float-right" title="REST">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/robomq/robomq.io/" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
      <span><a href="../WebSTOMP/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../REST/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme_extra.js" defer></script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
